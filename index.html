<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Black Clicker</title>
<style>
  body {
    background-color: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    margin: 0;
    padding: 2rem;
    user-select: none;
  }
  #cookie {
    background-color: black;
    border-radius: 50%;
    width: 180px;
    height: 180px;
    margin: 2rem auto;
    box-shadow: 0 0 20px #222;
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }
  #cookie:active {
    transform: scale(0.9);
    box-shadow: 0 0 40px #555;
  }
  /* Sparkle effect container */
  .sparkle {
    position: absolute;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
    pointer-events: none;
    animation: sparkle-fade 700ms forwards;
    filter: drop-shadow(0 0 2px white);
  }
  @keyframes sparkle-fade {
    0% {
      transform: translate(0, 0) scale(1);
      opacity: 0.8;
    }
    100% {
      transform: translate(var(--tx), var(--ty)) scale(0);
      opacity: 0;
    }
  }

  #score {
    font-size: 2.5rem;
    margin-top: 1rem;
    letter-spacing: 2px;
    font-variant-numeric: tabular-nums;
    transition: transform 0.2s ease;
  }
  #score.pop {
    transform: scale(1.3);
  }

  #upgrades {
    margin-top: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  .upgrade {
    background: #222;
    border: 2px solid #444;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: background 0.3s ease;
    position: relative;
    user-select: none;
  }
  .upgrade:hover:not(.disabled) {
    background: #333;
  }
  .upgrade.disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
  .upgrade-title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 0.2rem;
  }
  .upgrade-cost {
    color: #aaa;
  }

  /* Pulse animation for upgrade purchase */
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); }
    50% { box-shadow: 0 0 10px 6px rgba(255,255,255,0.9); }
    100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
  }
  .upgrade.pulse {
    animation: pulse 0.6s ease;
  }

  #reset-btn {
    margin-top: 1.5rem;
    padding: 0.7rem 2rem;
    font-size: 1rem;
    border: none;
    background-color: #222;
    color: #eee;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #reset-btn:hover {
    background-color: #555;
  }
  footer {
    margin-top: 3rem;
    font-size: 0.9rem;
    color: #555;
  }
</style>
</head>
<body>

<h1>Black Clicker</h1>
<div id="cookie" title="Click me!"></div>
<div id="score">0 cookies</div>

<div id="upgrades">
  <div class="upgrade" id="cursor-upgrade" title="Automatically click 1 cookie per second">
    <div class="upgrade-title">Cursor</div>
    <div>Cost: <span class="upgrade-cost" id="cursor-cost">10</span> cookies</div>
    <div>Owned: <span id="cursor-owned">0</span></div>
  </div>
  <div class="upgrade" id="grandma-upgrade" title="Automatically produce 5 cookies per second">
    <div class="upgrade-title">Grandma</div>
    <div>Cost: <span class="upgrade-cost" id="grandma-cost">50</span> cookies</div>
    <div>Owned: <span id="grandma-owned">0</span></div>
  </div>
  <div class="upgrade" id="farm-upgrade" title="Automatically produce 20 cookies per second">
    <div class="upgrade-title">Farm</div>
    <div>Cost: <span class="upgrade-cost" id="farm-cost">200</span> cookies</div>
    <div>Owned: <span id="farm-owned">0</span></div>
  </div>
  <div class="upgrade" id="factory-upgrade" title="Automatically produce 50 cookies per second">
    <div class="upgrade-title">Factory</div>
    <div>Cost: <span class="upgrade-cost" id="factory-cost">1000</span> cookies</div>
    <div>Owned: <span id="factory-owned">0</span></div>
  </div>
</div>

<button id="reset-btn">Reset Game</button>

<footer>Made by Gustav</footer>

<script>
  let score = 0;
  let cookiesPerSecond = 0;

  const cookie = document.getElementById('cookie');
  const scoreDisplay = document.getElementById('score');

  const upgrades = {
    cursor: {
      cost: 10,
      owned: 0,
      cps: 1,
      costIncreaseFactor: 1.15,
      element: document.getElementById('cursor-upgrade'),
      costElement: document.getElementById('cursor-cost'),
      ownedElement: document.getElementById('cursor-owned')
    },
    grandma: {
      cost: 50,
      owned: 0,
      cps: 5,
      costIncreaseFactor: 1.15,
      element: document.getElementById('grandma-upgrade'),
      costElement: document.getElementById('grandma-cost'),
      ownedElement: document.getElementById('grandma-owned')
    },
    farm: {
      cost: 200,
      owned: 0,
      cps: 20,
      costIncreaseFactor: 1.17,
      element: document.getElementById('farm-upgrade'),
      costElement: document.getElementById('farm-cost'),
      ownedElement: document.getElementById('farm-owned')
    },
    factory: {
      cost: 1000,
      owned: 0,
      cps: 50,
      costIncreaseFactor: 1.20,
      element: document.getElementById('factory-upgrade'),
      costElement: document.getElementById('factory-cost'),
      ownedElement: document.getElementById('factory-owned')
    }
  };

  function formatNumber(num) {
    return num.toLocaleString();
  }

  // Animate score briefly when it changes
  function animateScore() {
    scoreDisplay.classList.add('pop');
    setTimeout(() => scoreDisplay.classList.remove('pop'), 200);
  }

  function updateScoreDisplay() {
    scoreDisplay.textContent = `${formatNumber(score)} cookie${score !== 1 ? 's' : ''}`;
    animateScore();
  }

  function updateUpgradeDisplays() {
    for (const key in upgrades) {
      const upgrade = upgrades[key];
      upgrade.costElement.textContent = formatNumber(Math.floor(upgrade.cost));
      upgrade.ownedElement.textContent = upgrade.owned;

      if (score >= upgrade.cost) {
        upgrade.element.classList.remove('disabled');
      } else {
        upgrade.element.classList.add('disabled');
      }
    }
  }

  // Save and load game data with offline progress
  function saveGame() {
    const saveData = {
      score,
      upgrades: {},
      lastTimestamp: Date.now()
    };
    for (const key in upgrades) {
      saveData.upgrades[key] = {
        owned: upgrades[key].owned,
        cost: upgrades[key].cost
      };
    }
    localStorage.setItem('blackClickerSave', JSON.stringify(saveData));
  }

  function loadGame() {
    const saved = localStorage.getItem('blackClickerSave');
    if (saved) {
      try {
        const data = JSON.parse(saved);

        if (data.lastTimestamp) {
          const now = Date.now();
          const elapsedSeconds = Math.floor((now - data.lastTimestamp) / 1000);

          // Sum total CPS from saved upgrades
          let offlineCPS = 0;
          if (data.upgrades) {
            for (const key in data.upgrades) {
              if (upgrades[key]) {
                offlineCPS += (upgrades[key].cps || 0) * (data.upgrades[key].owned || 0);
              }
            }
          }

          const offlineCookies = offlineCPS * elapsedSeconds;

          if (offlineCookies > 0) {
            alert(`Welcome back! You earned ${formatNumber(offlineCookies)} cookie${offlineCookies !== 1 ? 's' : ''} while you were away.`);
          }

          score = (data.score || 0) + offlineCookies;
        } else {
          score = data.score || 0;
        }

        if (data.upgrades) {
          for (const key in data.upgrades) {
            if (upgrades[key]) {
              upgrades[key].owned = data.upgrades[key].owned || 0;
              upgrades[key].cost = data.upgrades[key].cost || upgrades[key].cost;
            }
          }
        }
      } catch {
        score = 0;
      }
    }
    updateCookiesPerSecond();
    updateScoreDisplay();
    updateUpgradeDisplays();
  }

  // Cookie click handler
  cookie.addEventListener('click', (e) => {
    score++;
    updateScoreDisplay();
    updateUpgradeDisplays();
    spawnSparkles(e.clientX, e.clientY);
    saveGame();
  });

  // Buy upgrade function with animation
  function buyUpgrade(key) {
    const upgrade = upgrades[key];
    if (score >= upgrade.cost) {
      score -= Math.floor(upgrade.cost);
      upgrade.owned++;
      upgrade.cost *= upgrade.costIncreaseFactor;
      updateCookiesPerSecond();
      updateScoreDisplay();
      updateUpgradeDisplays();
      saveGame();

      // Animate upgrade purchase pulse
      upgrade.element.classList.add('pulse');
      setTimeout(() => upgrade.element.classList.remove('pulse'), 600);
    }
  }

  for (const key in upgrades) {
    upgrades[key].element.addEventListener('click', () => buyUpgrade(key));
  }

  // Calculate total cookies per second from upgrades
  function updateCookiesPerSecond() {
    cookiesPerSecond = 0;
    for (const key in upgrades) {
      cookiesPerSecond += upgrades[key].owned * upgrades[key].cps;
    }
  }

  // Auto clicker interval (adds cookies per second)
  setInterval(() => {
    if (cookiesPerSecond > 0) {
      score += cookiesPerSecond;
      updateScoreDisplay();
      updateUpgradeDisplays();
      saveGame();
    }
  }, 1000);

  // Reset button
  const resetBtn = document.getElementById('reset-btn');
  resetBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to reset your game?')) {
      score = 0;
      cookiesPerSecond = 0;
      for (const key in upgrades) {
        upgrades[key].owned = 0;
        switch (key) {
          case 'cursor': upgrades[key].cost = 10; break;
          case 'grandma': upgrades[key].cost = 50; break;
          case 'farm': upgrades[key].cost = 200; break;
          case 'factory': upgrades[key].cost = 1000; break;
        }
      }
      updateScoreDisplay();
      updateUpgradeDisplays();
      saveGame();
    }
  });

  // Sparkle effect on click (more sparkles & varied timing)
  function spawnSparkles(x, y) {
    const rect = cookie.getBoundingClientRect();
    const sparkleCount = 15;
    for (let i = 0; i < sparkleCount; i++) {
      const sparkle = document.createElement('div');
      sparkle.classList.add('sparkle');
      const angle = Math.random() * 2 * Math.PI;
      const distance = 20 + Math.random() * 40;
      sparkle.style.setProperty('--tx', `${Math.cos(angle) * distance}px`);
      sparkle.style.setProperty('--ty', `${Math.sin(angle) * distance}px`);
      sparkle.style.left = (x - rect.left) + 'px';
      sparkle.style.top = (y - rect.top) + 'px';
      sparkle.style.animationDelay = (i * 40) + 'ms';
      cookie.appendChild(sparkle);
      sparkle.addEventListener('animationend', () => sparkle.remove());
    }
  }

  // Initial load
  loadGame();
</script>

</body>
</html>
